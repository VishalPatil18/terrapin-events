# Event Type
type Event {
  id: ID!
  title: String!
  description: String!
  startDateTime: AWSDateTime!
  endDateTime: AWSDateTime!
  location: Location!
  category: EventCategory!
  capacity: Int!
  registeredCount: Int!
  waitlistCount: Int!
  organizerId: ID!
  organizer: User!
  status: EventStatus!
  tags: [String!]
  imageUrl: String
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
  
  # Week 7: Search and Discovery fields
  slug: String
  shareableUrl: String
  availableSeats: Int
  waitlistAvailable: Boolean
}

# User Type
type User {
  id: ID!
  email: AWSEmail!
  firstName: String!
  lastName: String!
  role: UserRole!
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

# Registration Type
type Registration {
  id: ID!
  userId: ID!
  eventId: ID!
  event: Event  # Related event details
  status: RegistrationStatus!
  qrCode: String!
  waitlistPosition: Int
  promotionDeadline: AWSDateTime
  registeredAt: AWSDateTime!
  attendedAt: AWSDateTime
}

# Week 7: Calendar Event Type (simplified for calendar views)
type CalendarEvent {
  id: ID!
  title: String!
  start: AWSDateTime!
  end: AWSDateTime!
  location: String!
  availableSeats: Int!
  category: EventCategory!
  status: EventStatus!
}

# Week 7: Search Result Type
type SearchResult {
  items: [Event!]!
  total: Int!
  nextToken: String
  facets: SearchFacets
}

# Week 7: Search Facets Type
type SearchFacets {
  categories: [FacetCount!]!
  locations: [FacetCount!]!
  tags: [FacetCount!]!
}

# Week 7: Facet Count Type
type FacetCount {
  value: String!
  count: Int!
}

# Event Capacity Info Type
type EventCapacityInfo {
  eventId: ID!
  capacity: Int!
  registeredCount: Int!
  waitlistCount: Int!
  availableSeats: Int!
  isFull: Boolean!
}

# Location Type
type Location {
  name: String!
  building: String!
  room: String
  address: String!
  coordinates: Coordinates
}

type Coordinates {
  latitude: Float!
  longitude: Float!
}

# Enums
enum EventCategory {
  ACADEMIC
  SOCIAL
  SPORTS
  ARTS
  TECH
  CAREER
  OTHER
}

enum EventStatus {
  DRAFT
  PENDING_APPROVAL
  PUBLISHED
  CANCELLED
  COMPLETED
}

enum UserRole {
  PARTICIPANT
  ORGANIZER
  ADMINISTRATOR
  SUPER_ADMIN
}

enum RegistrationStatus {
  REGISTERED
  WAITLISTED
  PROMOTION_PENDING
  ATTENDED
  NO_SHOW
  CANCELLED
}

# Queries
type Query {
  # Events
  getEvent(id: ID!): Event
  listEvents(
    filter: EventFilter
    limit: Int
    nextToken: String
  ): EventConnection!
  searchEvents(query: String!): [Event!]!
  
  # Week 7: Advanced Search and Discovery
  advancedSearchEvents(input: SearchQueryInput!): SearchResult!
    @aws_cognito_user_pools
  
  getCalendarEvents(input: CalendarEventsInput!): [CalendarEvent!]!
    @aws_cognito_user_pools
  
  getEventBySlug(slug: String!): Event
    @aws_cognito_user_pools
  
  # Users
  getUser(id: ID!): User
  getCurrentUser: User!
  
  # Registrations
  getRegistration(id: ID!): Registration
  listMyRegistrations: [Registration!]!
  checkUserRegistration(eventId: ID!): Registration
  getEventCapacity(eventId: ID!): EventCapacityInfo!
}

# Mutations
type Mutation {
  # Events
  createEvent(input: CreateEventInput!): Event!
  updateEvent(id: ID!, input: UpdateEventInput!): Event!
  deleteEvent(id: ID!): Event!
  publishEvent(id: ID!): Event!
  
  # Registrations
  registerForEvent(eventId: ID!, idempotencyKey: String): Registration!
  cancelRegistration(registrationId: ID!): Registration!
  acceptPromotion(id: ID!): Registration!
  declinePromotion(id: ID!): Registration!
  checkInAttendee(registrationId: ID!): Registration!
  
  # Users
  updateUserProfile(input: UpdateUserInput!): User!
}

# Subscriptions
type Subscription {
  onEventUpdate(eventId: ID!): Event
    @aws_subscribe(mutations: ["updateEvent", "publishEvent"])
  
  onNewRegistration(eventId: ID!): Registration
    @aws_subscribe(mutations: ["registerForEvent"])
}

# Input Types
input CreateEventInput {
  title: String!
  description: String!
  startDateTime: AWSDateTime!
  endDateTime: AWSDateTime!
  location: LocationInput!
  category: EventCategory!
  capacity: Int!
  tags: [String!]
  imageUrl: String
}

input UpdateEventInput {
  title: String
  description: String
  startDateTime: AWSDateTime
  endDateTime: AWSDateTime
  location: LocationInput
  category: EventCategory
  capacity: Int
  tags: [String!]
  imageUrl: String
  status: EventStatus
}

input LocationInput {
  name: String!
  building: String!
  room: String
  address: String!
  coordinates: CoordinatesInput
}

input CoordinatesInput {
  latitude: Float!
  longitude: Float!
}

input UpdateUserInput {
  firstName: String
  lastName: String
}

input EventFilter {
  category: EventCategory
  status: EventStatus
  startDateAfter: AWSDateTime
  startDateBefore: AWSDateTime
}

# Week 7: Advanced Search Input Types
input SearchQueryInput {
  query: String!
  filters: SearchFilters
  pagination: PaginationInput
  sort: SortInput
}

input SearchFilters {
  categories: [EventCategory!]
  locations: [String!]
  startDateAfter: AWSDateTime
  startDateBefore: AWSDateTime
  hasAvailableSeats: Boolean
  tags: [String!]
}

input PaginationInput {
  limit: Int
  nextToken: String
}

input SortInput {
  field: String!
  order: String!
}

input CalendarEventsInput {
  year: Int!
  month: Int!
  view: String
  filters: CalendarFiltersInput
}

input CalendarFiltersInput {
  categories: [EventCategory!]
  locations: [String!]
}

# Connection Types
type EventConnection {
  items: [Event!]!
  nextToken: String
}

# Schema
schema {
  query: Query
  mutation: Mutation
  subscription: Subscription
}
